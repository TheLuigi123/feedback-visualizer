       // Initialize Flatpickr
       function initializeCalendar() {
           const dateDisplayElement = document.getElementById('date-display');
           if (dateDisplayElement && !calendarInstance) {
               console.log("Initializing Flatpickr on #date-display...");
               calendarInstance = flatpickr(dateDisplayElement, {
                   // --- Use Alternate Input for Display ---
                   altInput: true, // Create a separate visible input
                   // CORRECTED FORMAT: Use uppercase 'Y' for 4-digit year
                   altFormat: "l, d/m/Y", // Format for the VISIBLE input (Weekday, DD/MM/YYYY)
                   dateFormat: "Y-m-d",   // Format for the HIDDEN input (internal value)

                   defaultDate: currentDate,
                   allowInput: false, // Don't allow typing into the visible input
                   onChange: function(selectedDates, dateStr, instance) {
                       if (selectedDates.length > 0) {
                           // dateStr here is based on dateFormat (Y-m-d), NOT altFormat
                           console.log("Calendar date selected (hidden value):", dateStr);
                           // Compare using the actual Date objects or our consistent formatDate helper
                           if (formatDate(selectedDates[0]) !== formatDate(currentDate)) {
                               currentDate = selectedDates[0];
                               resetColorFilters();
                               displayGroupCounts(); // Fetch and display data for the new date
                           } else {
                               console.log("Date selected is the same as current date.");
                           }
                       }
                   },
                   onReady: function(selectedDates, dateStr, instance) {
                       console.log("Flatpickr ready.");
                       // instance.input is the original element (#date-display)
                       // instance.altInput is the visible input element Flatpickr created
                       console.log("Original input (should be hidden):", instance.input);
                       console.log("Alternate (visible) input:", instance.altInput);
                       if (instance.input && window.getComputedStyle(instance.input).display !== 'none') {
                           console.warn("Original #date-display element is still visible after Flatpickr init!");
                           // instance.input.style.display = 'none'; // You could force hide here if needed
                       }
                        // Log the initial formatted date displayed
                       if(instance.altInput) {
                           console.log("Flatpickr initial display value (altInput):", instance.altInput.value);
                       }
                   },
                   errorHandler: function(error) {
                       console.error("Flatpickr Error:", error);
                       updateStatus("Calendar initialization error.", true);
                   }
               });
               console.log("Flatpickr instance created with altInput: true.");
           } else if (!dateDisplayElement) {
               console.error("Could not find #date-display to initialize calendar.");
           } else {
               console.log("Flatpickr already initialized.");
           }
       }
